import{readFileSync as b}from"node:fs";import{createLogger as j,normalizePath as x}from"vite";import I from"gray-matter";import{glob as U}from"tinyglobby";import{createMarkdownRenderer as k}from"vitepress";import{join as A,relative as P}from"node:path";import s from"picocolors";const W="1.0.12",i=j("info",{prefix:`[vitepress-plugin-file-content-loader v${W}]`}),z=(e,r="green",t={timestamp:!0})=>{i.info(s[r](e),t)},G=(e,r="yellow",t={timestamp:!0})=>{i.warn(s[r](e),t)},K=(e,r="yellow",t={timestamp:!0})=>{i.info(s[r](e),t)},M=(e,r="red",t={timestamp:!0})=>{i.error(s[r](e),t)},N={info:z,warn:G,warnOnce:K,error:M},T=["**/node_modules/**","**/dist/**"];function q(e){let r=!1;return{name:"vite-plugin-vitepress-file-content-loader",async config(t){if(r)return;r=!0;let{pattern:o}=e;if(!o)return;const{includeSrc:y=!1,render:D=!1,excerpt:a,transformData:p,transformRaw:d,globOptions:u,themeConfigKey:c="contentLoader"}=e,{site:{themeConfig:$={},base:_},srcDir:m,cleanUrls:E,markdown:R}=t.vitepress;typeof o=="string"&&(o=[o]),o=o.map(n=>x(A(m,n)));const C=(await U(o,{expandDirectories:!1,...u,ignore:["**/node_modules/**","**/dist/**",...u?.ignore||[]]})).sort(),g=await k(m,R,_,i),f=[];for(const n of C){if(!n.endsWith(".md"))continue;const l=b(n,"utf-8"),{data:F,excerpt:h}=I(l,typeof a=="string"?{excerpt_separator:a}:{excerpt:a}),L="/"+x(P(m,n)).replace(/(^|\/)index\.md$/,"$1").replace(/\.md$/,E?"":".html"),O=D?g.render(l):void 0,S=a&&h?.endsWith(`
`)?g.render(h):void 0,v={src:y?l:void 0,html:O,frontmatter:F,excerpt:S,url:L};f.push(p?await p(v):v)}$[c]=d?await d(f):f;const w=c.charAt(0).toUpperCase()+c.slice(1);N.info(`Injected ${w} Data Successfully. \u6CE8\u5165 ${w} \u6570\u636E\u6210\u529F!`)}}}export{T as DEFAULT_IGNORE_DIR,q as default};
